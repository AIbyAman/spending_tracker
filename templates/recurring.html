{% extends 'base.html' %}
{% block content %}
<div class="row mb-4">
  <div class="col">
    <h2 class="mb-0"><i class="fas fa-repeat"></i> Recurring Expenses</h2>
  </div>
  <div class="col-auto">
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addRecurringModal"><i class="fas fa-plus"></i> Add Recurring</button>
  </div>
</div>

<div class="card border-0 shadow-sm">
  <div class="table-responsive">
    <table class="table table-hover mb-0">
      <thead class="table-light">
        <tr>
          <th><i class="fas fa-tag"></i> Category</th>
          <th>Description</th>
          <th class="text-end"><i class="fas fa-dollar-sign"></i> Amount</th>
          <th><i class="fas fa-sync"></i> Frequency</th>
          <th><i class="fas fa-calendar-check"></i> Start</th>
        </tr>
      </thead>
      <tbody>
        {% for r in recurring %}
        <tr>
          <td><span class="badge bg-warning">{{ r['category'] }}</span></td>
          <td>{{ r['description'] }}</td>
          <td class="text-end fw-bold">${{ '%.2f'|format(r['amount']) }}</td>
          <td><span class="badge bg-secondary">{{ r['frequency'] }}</span></td>
          <td>{{ r['start_date'] }}</td>
        </tr>
        {% else %}
        <tr><td colspan="5" class="text-center py-4 text-muted">No recurring expenses. <a href="#" data-bs-toggle="modal" data-bs-target="#addRecurringModal">Add one</a></td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<div class="modal fade" id="addRecurringModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content border-0">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title"><i class="fas fa-plus"></i> Add Recurring Expense</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <form method="post">
        <div class="modal-body">
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Amount</label>
              <input class="form-control form-control-lg" type="number" step="0.01" name="amount" placeholder="0.00" required>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Category</label>
              <select class="form-control form-control-lg" name="category" required>
                <option value="">Select category</option>
                {% for c in categories %}
                <option>{{ c['name'] }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">Description</label>
            <input class="form-control form-control-lg" name="description" placeholder="e.g., Netflix subscription">
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Frequency</label>
              <select class="form-control form-control-lg" name="frequency" required>
                <option value="daily">Daily</option>
                <option value="weekly">Weekly</option>
                <option value="monthly" selected>Monthly</option>
                <option value="yearly">Yearly</option>
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Start Date</label>
              <input class="form-control form-control-lg" type="date" name="start_date" required>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">End Date (optional)</label>
            <input class="form-control form-control-lg" type="date" name="end_date">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
